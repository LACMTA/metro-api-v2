<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">WebSocket to Me! | Metro API</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://api.metro.net/metro-api-v2/blog/websocket-to-me"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="WebSocket to Me! | Metro API"><meta data-rh="true" name="description" content="Hola Metro A-PIoneers! Today we are launching 2.1.21 of our API which is a minor version release that enables websockets!"><meta data-rh="true" property="og:description" content="Hola Metro A-PIoneers! Today we are launching 2.1.21 of our API which is a minor version release that enables websockets!"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-03-29T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/albertkun"><meta data-rh="true" property="article:tag" content="api,websockets,update"><link data-rh="true" rel="icon" href="/metro-api-v2/img/favicon.png"><link data-rh="true" rel="canonical" href="https://api.metro.net/metro-api-v2/blog/websocket-to-me"><link data-rh="true" rel="alternate" href="https://api.metro.net/metro-api-v2/blog/websocket-to-me" hreflang="en"><link data-rh="true" rel="alternate" href="https://api.metro.net/metro-api-v2/blog/websocket-to-me" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/metro-api-v2/blog/rss.xml" title="Metro API RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/metro-api-v2/blog/atom.xml" title="Metro API Atom Feed"><link rel="stylesheet" href="/metro-api-v2/assets/css/styles.34edbeaf.css">
<link rel="preload" href="/metro-api-v2/assets/js/runtime~main.b16ebb17.js" as="script">
<link rel="preload" href="/metro-api-v2/assets/js/main.28d709c3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/metro-api-v2/"><div class="navbar__logo"><img src="/metro-api-v2/img/favicon.png" alt="Metro API Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/metro-api-v2/img/favicon.png" alt="Metro API Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Metro API</b></a><a class="navbar__item navbar__link" href="/metro-api-v2/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/metro-api-v2/blog">Blog</a><a class="navbar__item navbar__link" href="/metro-api-v2/docs/api">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lacmta/metro-api-v2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/metro-api-v2/blog/websocket-to-me">WebSocket to Me!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/metro-api-v2/blog/hello-world">Hello World!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/metro-api-v2/blog/api-documentation-launch">API 2.0 Documentation Launch ðŸš€</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/metro-api-v2/blog/long-blog-post">Long Blog Post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/metro-api-v2/blog/mdx-blog-post">MDX Blog Post</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">WebSocket to Me!</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-03-29T00:00:00.000Z" itemprop="datePublished">March 29, 2023</time> Â· <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/albertkun" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/8574425?v=4" alt="Albert Kochaphum"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/albertkun" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Albert Kochaphum</span></a></div><small class="avatar__subtitle" itemprop="description">API Guy</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Hola Metro A-PIoneers! Today we are launching <strong>2.1.21</strong> of our API which is a minor version release that enables websockets!</p><p>Currently, every 10 seconds the <code>live/trip_detail</code> websocket returns trip details for a route, alongside headsign and current stop information. </p><p>You can find the URL of the websockets here:</p><p><code>wss://api.metro.net/{AGENCY_ID}/live/trip_detail/route_code/{ROUTE_CODE}?geojson={BOOLEAN}</code></p><ul><li><code>{AGENCY_ID}</code> can either be <code>LACMTA</code> for bus or <code>LACMTA_Rail</code> for LACMTA_Rail</li><li><code>{ROUTE_CODE}</code> can be a line, like the <code>720</code> or <code>801</code></li><li><code>{BOOLEAN}</code> for geojson value of <code>True</code> is ONLY supported right now.</li></ul><p>A working example WebSocket would be:</p><ul><li><code>wss://api.metro.net/LACMTA/live/trip_detail/route_code/720?geojson=True</code></li></ul><p>You can check this page to play around:</p><ul><li><a href="https://api.metro.net/websocket_test" target="_blank" rel="noopener noreferrer">https://api.metro.net/websocket_test</a></li></ul><p>Feel free to request to see what else you&#x27;d like to see on the GitHub <a href="https://github.com/LACMTA/metro-api-v2/issues" target="_blank" rel="noopener noreferrer">issues board</a>!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-devil-is-in-the-websocket-details">The devil is in the (WebSocket) details<a class="hash-link" href="#the-devil-is-in-the-websocket-details" title="Direct link to heading">â€‹</a></h3><p>And gosh, were websockets a pain to implement!!! While FastAPI has good support for websockets, our API was not meant for asynchronous calls.</p><p>Why did we need these asynchronous calls? Well, the data we wanted to send through websockets was live GTFS Real Time data that was also joined to the GTFS Static data.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="technology-stack">Technology Stack<a class="hash-link" href="#technology-stack" title="Direct link to heading">â€‹</a></h2><p>The API needed to be basically re-done for async calls through <code>asyncpg</code> with <code>aysncio</code> and new updated <code>sqlalchemy</code> commands.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="asyncpg">asyncpg<a class="hash-link" href="#asyncpg" title="Direct link to heading">â€‹</a></h3><p>We needed to redo the database connection to listen for live updates, so we connected using asyncpg.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sqlalchemy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">asyncio </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> create_async_engine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AsyncSession</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We then re-did our SqlAlchemy engine to connect using the async url: </p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async_engine </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> create_async_engine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">create_async_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">API_DB_URI</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> echo</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async_session </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sessionmaker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">async_engine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> expire_on_commit</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> class_</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">AsyncSession</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally we created a new function to connect to the database:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_async_db</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> async_session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> async_engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Phew!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronously-querying-the-data">Asynchronously querying the data<a class="hash-link" href="#asynchronously-querying-the-data" title="Direct link to heading">â€‹</a></h3><p>Now that we were connected to the database, we had to re-do the queries!</p><p>For async calls, SqlAlchemy uses <code>.select</code> instead of <code>.query</code> so our code went from:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    the_query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gtfs_models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VehiclePosition</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gtfs_models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VehiclePosition</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">agency_id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> agency_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>to:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">the_query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gtfs_models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VehiclePosition</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gtfs_models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VehiclePosition</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">route_code </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> route_code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">gtfs_models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VehiclePosition</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">agency_id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> agency_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the results needed to be converted to <code>scalars</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    for row in the_query.scalars().all():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(row)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All the code is in the API&#x27;s <code>database.py</code>,<code>main.py</code>, <code>crud.py</code> here: <a href="https://github.com/LACMTA/metro-api-v2/tree/main/fastapi/app" target="_blank" rel="noopener noreferrer">https://github.com/LACMTA/metro-api-v2/tree/main/fastapi/app</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">â€‹</a></h2><p>After being pummeled by websockets for the past couple of weeks, all I can say is that it&#x27;s been pretty painful. </p><p>I just can&#x27;t wait until someone comes up with <code>webmittens</code> next.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/metro-api-v2/blog/tags/api">api</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/metro-api-v2/blog/tags/websockets">websockets</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/metro-api-v2/blog/tags/update">update</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/metro-api-v2/blog/hello-world"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Hello World!</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-devil-is-in-the-websocket-details" class="table-of-contents__link toc-highlight">The devil is in the (WebSocket) details</a></li><li><a href="#technology-stack" class="table-of-contents__link toc-highlight">Technology Stack</a><ul><li><a href="#asyncpg" class="table-of-contents__link toc-highlight">asyncpg</a></li><li><a href="#asynchronously-querying-the-data" class="table-of-contents__link toc-highlight">Asynchronously querying the data</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/metro-api-v2/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/metrolosangeles" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/metro-api-v2/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/lacmta/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023</div></div></div></footer></div>
<script src="/metro-api-v2/assets/js/runtime~main.b16ebb17.js"></script>
<script src="/metro-api-v2/assets/js/main.28d709c3.js"></script>
</body>
</html>